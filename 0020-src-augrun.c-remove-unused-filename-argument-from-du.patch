From 891a822ba18c987a26957dc4f7979f65c4f1160a Mon Sep 17 00:00:00 2001
From: Dominic Cleal <dcleal@redhat.com>
Date: Mon, 2 Jun 2014 16:05:30 +0100
Subject: [PATCH] * src/augrun.c: remove unused "filename" argument from
 dump-xml command

Fixes RHBZ#1100106

(cherry picked from commit e775e5f85183a76c584219b14963368a66171375)

Conflicts:
	NEWS
---
 man/augtool.1   |  7 +++----
 man/augtool.pod |  5 ++---
 src/augrun.c    | 11 ++---------
 3 files changed, 7 insertions(+), 16 deletions(-)

diff --git a/man/augtool.1 b/man/augtool.1
index 1069286..f5531fa 100644
--- a/man/augtool.1
+++ b/man/augtool.1
@@ -262,11 +262,10 @@ the \s-1FILE\s0 will be excluded from the \s-1LENS. FILE\s0 may contain wildcard
 .SS "\s-1READ COMMANDS\s0"
 .IX Subsection "READ COMMANDS"
 The following commands are used to retrieve data from the Augeas tree.
-.IP "\fBdump-xml\fR \fI[<\s-1PATH\s0>]\fR \fI[<\s-1FILENAME\s0>]\fR" 4
-.IX Item "dump-xml [<PATH>] [<FILENAME>]"
+.IP "\fBdump-xml\fR \fI[<\s-1PATH\s0>]\fR" 4
+.IX Item "dump-xml [<PATH>]"
 Print entries in the tree as \s-1XML.\s0 If \s-1PATH\s0 is given, printing starts there,
-otherwise the whole tree is printed. If \s-1FILENAME\s0 is given, the \s-1XML\s0 is saved
-to the given file.
+otherwise the whole tree is printed.
 .IP "\fBget\fR <\s-1PATH\s0>" 4
 .IX Item "get <PATH>"
 Print the value associated with \s-1PATH\s0
diff --git a/man/augtool.pod b/man/augtool.pod
index 42e5683..4940b38 100644
--- a/man/augtool.pod
+++ b/man/augtool.pod
@@ -160,11 +160,10 @@ The following commands are used to retrieve data from the Augeas tree.
 
 =over 4
 
-=item B<dump-xml> I<[E<lt>PATHE<gt>]> I<[E<lt>FILENAMEE<gt>]>
+=item B<dump-xml> I<[E<lt>PATHE<gt>]>
 
 Print entries in the tree as XML. If PATH is given, printing starts there,
-otherwise the whole tree is printed. If FILENAME is given, the XML is saved
-to the given file.
+otherwise the whole tree is printed.
 
 =item B<get> E<lt>PATHE<gt>
 
diff --git a/src/augrun.c b/src/augrun.c
index 2677484..87b639e 100644
--- a/src/augrun.c
+++ b/src/augrun.c
@@ -895,30 +895,23 @@ static const struct command_def cmd_print_def = {
 
 static void cmd_dump_xml(struct command *cmd) {
     const char *path = arg_value(cmd, "path");
-    const char *filename = arg_value(cmd, "filename");
     xmlNodePtr xmldoc;
     int r;
 
     r = aug_to_xml(cmd->aug, path, &xmldoc, 0);
     if (r < 0)
         ERR_REPORT(cmd, AUG_ECMDRUN,
-                   "XML export of path %s to file %s failed", path, filename);
+                   "XML export of path %s failed", path);
 
     xmlElemDump(stdout, NULL, xmldoc);
     printf("\n");
 
-    if (filename != NULL) {
-        printf("Saving to %s\n", filename);
-    }
-
     xmlFreeNode(xmldoc);
 }
 
 static const struct command_opt_def cmd_dump_xml_opts[] = {
     { .type = CMD_PATH, .name = "path", .optional = true,
       .help = "print this subtree" },
-    { .type = CMD_NONE, .name = "filename", .optional = true,
-      .help = "save to this file" },
     CMD_OPT_DEF_LAST
 };
 
@@ -927,7 +920,7 @@ static const struct command_def cmd_dump_xml_def = {
     .opts = cmd_dump_xml_opts,
     .handler = cmd_dump_xml,
     .synopsis = "print a subtree as XML",
-    .help = "Export entries in the tree as XML. If PATH is given, printing starts there,\n otherwise the whole tree is printed. If FILENAME is given, the XML is saved\n to the given file."
+    .help = "Export entries in the tree as XML. If PATH is given, printing starts there,\n otherwise the whole tree is printed."
 };
 
 static void cmd_transform(struct command *cmd) {
